syms q_1 q_2 q_3 q_4 q_5 q_6 q_7
syms l_1 l_2 l_3 l_4

T_01=   ...
    [   cos(q_1),   -sin(q_1),  0,  0;
        sin(q_1),   cos(q_1),   0,  0;
        0,          0           1,  l_1;
        0,          0,          0,  1]; 
T_12=   ...
    [   cos(q_2),   -sin(q_2),  0,  0;
        0,          0,          1,  0;
        -sin(q_2),  -cos(q_2),  0,  0;
        0,          0,          0,  1];
T_23=   ...
    [   cos(q_3),  -sin(q_3),  0,   0;
        0,         0,          -1,  -l_2;
        sin(q_3),   cos(q_3),   0,  0;
        0,          0,          0,  1];
T_34=   ...
    [   cos(q_4),   -sin(q_4),  0,  l_3;
        0,          0,          -1, 0;
        sin(q_4),   cos(q_4),   0,  0;
        0,          0,          0,  1];
T_45=   ...
    [   cos(q_5),   -sin(q_5),  0,  -l_3;
        0,          0,          1,  l_4;
        -sin(q_5),  -cos(q_5),  0,  0;
        0,          0,          0,  1];
T_56=   ...
    [   cos(q_6),   -sin(q_6),  0,  0;
        0,          0,          -1, 0;
        sin(q_6),   cos(q_6),   0,  0;
        0,          0,          0,  1];
T_67=   ...
    [   cos(q_7),   -sin(q_7),  0,  l_3;
        0,          0,          -1, 0;
        sin(q_7),   cos(q_7),   0,  0;
        0,          0,          0,  1];


% T_01= ModifiedDH(0,0,l_1,q_1);
% T_12= ModifiedDH(-pi/2,0,0,q_2);
% T_23= ModifiedDH(pi/2,0,l_2,q_3);
% T_34= ModifiedDH(pi/2,l_3,0,q_4);
% T_45= ModifiedDH(-pi/2,-l_3,l_4,q_5);
% T_56= ModifiedDH(pi/2,0,0,q_6);
% T_67= ModifiedDH(pi/2,l_3,0,q_7);

T_07=T_01*T_12*T_23*T_34*T_45*T_56*T_67;

% q_1=0;
% q_2=0;
% q_3=0;
% q_4=0;
% q_5=0;
% q_6=0;
% q_7=0;
% l_1=0.330;
% l_2=0.3160;
% l_3=0.0880;
% l_4=0.3840;
% 
% T_07 = subs(T_07)






J_v = jacobian([T_07(1,4),T_07(2,4),T_07(3,4)],[q_1,q_2,q_3,q_4,q_5,q_6,q_7])

% q_1=0;
% q_2=0;
% q_3=0;
% q_4=0;
% q_5=0;
% q_6=0;
% q_7=0;

% J_v_0 = subs(J_v)


z_0=[0;0;1];
R_01=T_01([1,2,3],[1,2,3]);
z_1=R_01*z_0


T_02=T_01*T_12;
R_02=T_02([1,2,3],[1,2,3]);
z_2=R_02'*z_0

T_03=T_02*T_23;
R_03=T_03([1,2,3],[1,2,3]);
z_3=R_03*z_0

T_04=T_03*T_34;
R_04=T_04([1,2,3],[1,2,3]);
z_4=R_04*z_0

T_05=T_04*T_45;
R_05=T_05([1,2,3],[1,2,3]);
z_5=R_05*z_0

T_06=T_05*T_56;
R_06=T_06([1,2,3],[1,2,3]);
z_6=R_06*z_0

T_07=T_06*T_67;
R_07=T_07([1,2,3],[1,2,3]);
z_7=R_07*z_0

J_omega = [z_1,z_2,z_3,z_4,z_5,z_6,z_7];

J=[J_v;J_omega]



% 
q_1=0;
q_2=0;
q_3=0;
q_4=0;
q_5=0;
q_6=0;
q_7=0;
l_1=0.33
l_2=0.316
l_3=0.088
l_4=0.384

J = subs(J)
% J = vpa(J,3)

% inv(J*(J'))
pinv(J)
J_pseudoinverse = (J')*inv(J*(J'))

% 
% T_03=T_02*T_23
% R_03=T_03([1,2,3],[1,2,3])
% z_3=inv(R_03)*z_0


